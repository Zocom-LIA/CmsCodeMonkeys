@page "/sites/{siteId:int}/webpages/{webPageId:int}/edit"
@using System.ComponentModel.DataAnnotations
@using CodeMonkeys.CMS.Public.Shared.Entities
@using CodeMonkeys.CMS.Public.Shared.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using CodeMonkeys.CMS.Public.Components.Shared

@inherits BaseComponent<EditWebPage>
@rendermode InteractiveServer
@attribute [Authorize(Roles = "User, Admin")]

<div class="backbutton">
    @* Gå tillbaka *@
    <a href="javascript:history.back()"><button>Gå tillbaka</button></a>
</div>

<div class="Content_Layout">

<h3>Edit page</h3>

<EditForm Model="Input" method="post" OnValidSubmit="HandleValidSubmit" FormName="updatewebpage">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <StatusMessage Message="@ErrorMessage" />

        <div class="form-floating mb-3">
            <InputText @bind-Value="Input.Title" class="form-control" autocomplete="name" aria-required="true" placeholder="Unique site name" hidden="@(Content != null)" />
            <label for="name" class="form-label">Site Name</label>
            <ValidationMessage For="() => Input.Title" class="text-danger" />
        </div>
    @if (Content != null)
    {
            <div class="form-floating mb-3">
                <InputText @bind-Value="Content.Title" class="form-control" autocomplete="name" aria-required="true" placeholder="Content Title" />
                <label for="name" class="form-label">Content Title</label>
                <ValidationMessage For="() => Content.Title" class="text-danger" />
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" @bind="Content.ContentType">
                    @foreach (var type in Enum.GetValues(typeof(ContentTypes)))
                    {
                        <option Value="@type">@type.ToString()</option>
                    }
                </select>
                <label for="contentType" class="form-label">Content Type</label>
                <ValidationMessage For="() => Content.ContentType" class="text-danger" />
            </div>
            <div class="form-floating mb-3">
                <InputTextArea @bind-Value="Content.Body" class="form-control" autocomplete="name" aria-required="true" placeholder="Content Body" />
                <label for="name" class="form-label">Content Body</label>
                <ValidationMessage For="() => Content.Body" class="text-danger" />
            </div>
            <div class="form-floating mb-3">
                <InputNumber @bind-Value="Content.OrdinalNumber" class="form-control" autocomplete="name" aria-required="true" placeholder="Ordinal Number" />
                <label for="name" class="form-label">Ordinal Number</label>
                <ValidationMessage For="() => Content.OrdinalNumber" class="text-danger" />
            </div>
            <div>
                <button type="button" class="w-100 btn btn-lg btn-primary" @onclick="async () => await CreateOrUpdateContent()">Save Content!</button>
            </div>
    }
     <div>
        <button type="submit" class="w-100 btn btn-lg btn-primary">Save Non-Content</button>
    </div>

</EditForm>

</div>





@if (Confirmation != null)
{
    <div class="alert alert-alert" role="alert">
        @Confirmation
        <div>
            <button type="button" class="w-100 btn btn-lg btn-alert" @onclick="@Confirmation.OnConfirm">Are you sure?</button>
            <button type="button" class="w-100 btn btn-lg btn-info" @onclick="@Confirmation.OnCancel">Cancel</button>
        </div>
    </div>
}
@if (WebPage?.Contents != null && WebPage.Contents.Any())
{
    
        <h4>Content</h4>
    <div class="edit_webpage_content">
        <table class="table">
            <thead>
                <tr>
                    <th>Content Title</th>
                    <th>Content Type</th>
                    <th>Content Body</th>
                    <th>Created by</th>
                    <th>Created Date</th>
                    <th>Last Modified</th>
                    <th>Ordinal number</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (Content content in WebPage?.Contents ?? [])
                {
                    <tr>
                        <td data-label="Content Title">@content.Title</td>
                        <td data-label="Content Type">@content.ContentType</td>
                        <td data-label="Content Body">@content.Body</td>
                        <td data-label="Created by">@content.Author?.Email</td>
                        <td data-label="Created Date">@content.CreatedDate.ToString("yyyy-MM-dd")</td>
                        <td data-label="Last Modified">@content.LastModifiedDate.ToString("yyyy-MM-dd")</td>
                        <td data-label="Ordinal number">@content.OrdinalNumber</td>
                        <td data-label="Actions">
                            <div class="action-buttons-edit">
                                <button type="button" class="btn btn-primary" @onclick="async () => await EditContent(content.ContentId)">Edit</button>
                                <button type="button" class="btn btn-danger" @onclick="async () => await DeleteContent(content.ContentId)">Delete</button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<div>
    <button type="button" class="w-100 btn btn-lg btn-primary" @onclick="async () => await AddContent()">Add Content!</button>
</div>